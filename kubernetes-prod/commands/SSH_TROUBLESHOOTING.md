# Решение проблем с SSH подключением

## Проблема: Permission denied (publickey)

### Решение 1: Подождать применения метаданных

Метаданные ВМ могут применяться до 1-2 минут. Подождите и попробуйте снова:

```bash
# Подождите 30-60 секунд после добавления ключа
ssh -i ~/.ssh/k8s_cluster_key -l ubuntu 89.169.176.122
```

### Решение 2: Использовать веб-консоль (РЕКОМЕНДУЕТСЯ)

1. Откройте [Yandex Cloud Console](https://console.cloud.yandex.ru/)
2. Перейдите в **Compute Cloud** → **Виртуальные машины**
3. Найдите `k8s-master` и нажмите на неё
4. Нажмите **"Подключиться"** → **"SSH"** или **"Веб-терминал"**
5. Используйте веб-интерфейс

Это самый надежный способ для начальной настройки!

### Решение 3: Проверить правильность ключа

```bash
# Показать публичный ключ
cat ~/.ssh/k8s_cluster_key.pub

# Проверить, что ключ добавлен в ВМ
yc compute instance get k8s-master --format json | jq -r '.metadata."ssh-keys"'
```

### Решение 4: Добавить ключ через веб-консоль

1. Откройте ВМ в веб-консоли
2. Перейдите на вкладку **"SSH ключи"**
3. Нажмите **"Добавить ключ"**
4. Вставьте содержимое:
   ```bash
   cat ~/.ssh/k8s_cluster_key.pub
   ```
5. Сохраните

### Решение 5: Использовать Serial Console

1. В веб-консоли ВМ нажмите **"Подключиться"** → **"Serial Console"**
2. Войдите с учетными данными (если были установлены)

### Решение 6: Перезапустить ВМ

Иногда помогает перезапуск ВМ для применения метаданных:

```bash
yc compute instance restart k8s-master
yc compute instance restart k8s-worker-1
yc compute instance restart k8s-worker-2
yc compute instance restart k8s-worker-3
```

Подождите 1-2 минуты после перезапуска.

## Рекомендация

**Используйте веб-консоль Yandex Cloud** - это самый простой и надежный способ для начальной настройки ВМ.

После подключения через веб-консоль выполните команды из:
- `commands/QUICK_MASTER_SETUP.md`
- `commands/MASTER_COMMANDS.sh`
